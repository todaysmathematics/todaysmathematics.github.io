define(["../core","../var/isFunction","./var/nonce","./var/rquery","../ajax"],function(n,a,o,r){var t=[],e=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=t.pop()||n.expando+"_"+o++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(o,s,p){var l,c,i,j=!1!==o.jsonp&&(e.test(o.url)?"url":"string"==typeof o.data&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&e.test(o.data)&&"data");if(j||"jsonp"===o.dataTypes[0])return l=o.jsonpCallback=a(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,j?o[j]=o[j].replace(e,"$1"+l):!1!==o.jsonp&&(o.url+=(r.test(o.url)?"&":"?")+o.jsonp+"="+l),o.converters["script json"]=function(){return i||n.error(l+" was not called"),i[0]},o.dataTypes[0]="json",c=window[l],window[l]=function(){i=arguments},p.always(function(){void 0===c?n(window).removeProp(l):window[l]=c,o[l]&&(o.jsonpCallback=s.jsonpCallback,t.push(l)),i&&a(c)&&c(i[0]),i=c=void 0}),"script"})});